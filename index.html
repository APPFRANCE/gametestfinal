<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONEY DROP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

        body {
            margin: 0;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
        }

        .title-container {
            margin-top: 20px;
        }
        
        .title {
            font-size: 4em;
            color: #1a2e5d;
            font-family: Impact, sans-serif;
            text-align: center;
            text-transform: uppercase;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 80%;
            max-width: 1200px;
            margin-top: 20px;
            gap: 20px;
            position: relative;
        }

        .header-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            color: #ddd;
            font-size: 1em;
        }

        .status-indicator {
            position: absolute;
            top: 0;
            right: 0;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: red;
        }

        .ranking {
            font-size: 1.2em;
            color: #ddd;
            text-align: center;
            margin-top: 10px;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .button {
            background-color: #444;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-size: 1em;
            text-align: center;
        }

        .button:hover {
            background-color: #666;
        }

        .button:active {
            transform: scale(0.95);
        }

        .team-container {
            display: flex;
            justify-content: space-around;
            width: 80%;
            max-width: 1200px;
            margin-top: 20px;
            gap: 20px;
        }

        .team {
            text-align: center;
            background-color: #111;
            border-radius: 12px;
            padding: 20px;
            width: 30%;
            box-shadow: 0 4px 10px rgba(255, 0, 0, 0.5);
        }

        .team-name {
            color: #aaa;
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .points {
            font-size: 4em;
            color: #ff0000;
            font-family: 'Orbitron', sans-serif;
            background-color: #111;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }

        .team-details {
            margin-top: 10px;
            font-size: 0.9em;
            color: #ccc;
        }

        .freeze-timer {
            font-size: 1em;
            color: #ddd;
            margin-top: 5px;
        }

        .panel {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #222;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            text-align: center;
            z-index: 10;
            max-height: 60%;
            overflow-y: auto;
        }

        .log-entry {
            font-size: 0.9em;
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #333;
            text-align: left;
        }

        .countdown {
            font-size: 2em;
            color: #ddd;
            margin-top: 20px;
            position: absolute;
            bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="title-container">
        <div class="title">MONEY DROP</div>
    </div>

    <div class="status-indicator" id="statusIndicator"></div>

    <div class="header">
        <div class="header-info">
            <div>Temps de Freeze (points sauv√©s) : <span id="freezeTime">Nico: 0m, Yanis: 0m, Matt: 0m</span></div>
            <div>Indices trouv√©s : üîë <span id="indicesFound">Nico: 0, Yanis: 0, Matt: 0</span></div>
        </div>
        <div class="buttons">
            <div class="button" onclick="togglePanel('settingsPanel')">Settings</div>
            <div class="button" onclick="togglePanel('logPanel')">Log</div>
        </div>
    </div>

    <div class="ranking" id="ranking"></div>

    <div class="team-container">
        <div class="team">
            <div class="team-name">Equipe Nico</div>
            <div class="points" id="points-nico">10000</div>
            <div class="team-details">
                Capitaine: Nico<br>
                Team: FRP<br>
                Cust: Camille + Andela
            </div>
            <div class="freeze-timer" id="freeze-timer-nico"></div>
        </div>
        <div class="team">
            <div class="team-name">Equipe Yanis</div>
            <div class="points" id="points-yanis">10000</div>
            <div class="team-details">
                Capitaine: Yanis<br>
                Team: FRY / FRL / FRN / FRM / FRT / FRH / FRS<br>
                Cust: L√©na + Im√®ne
            </div>
            <div class="freeze-timer" id="freeze-timer-yanis"></div>
        </div>
        <div class="team">
            <div class="team-name">Equipe Matt</div>
            <div class="points" id="points-matt">10000</div>
            <div class="team-details">
                Capitaine: Matt<br>
                Team: FRA / FRD / FRC / FRR et FRB<br>
                Cust: Wendy + Sybille
            </div>
            <div class="freeze-timer" id="freeze-timer-matt"></div>
        </div>
    </div>

    <div class="panel settings-panel" id="settingsPanel">
        <h2>Modifier les Points & Freeze</h2>
        <select id="teamSelect">
            <option value="nico">Equipe Nico</option>
            <option value="yanis">Equipe Yanis</option>
            <option value="matt">Equipe Matt</option>
        </select>
        <input type="text" id="pointsInput" placeholder="Entrez + ou - suivi de la valeur">
        <button onclick="confirmClick(this); updatePoints()">Appliquer</button>
        <input type="number" id="freezeDuration" placeholder="Dur√©e Freeze (minutes)" min="1">
        <button class="freeze-button" id="freezeButton" onclick="confirmClick(this); toggleFreeze()">Freeze</button>
        <button onclick="confirmClick(this); undoLastAction()">Annuler la derni√®re action</button>
        <button onclick="toggleAutoDecrement()">D√©compte automatique: <span id="autoDecrementStatus">OFF</span></button>
        <button class="close-button" onclick="togglePanel('settingsPanel')">Fermer</button>
    </div>

    <div class="panel log-panel" id="logPanel">
        <h2>Historique des Actions</h2>
        <div id="logContent" class="log-content"></div>
        <button onclick="clearLog()">Clear Log</button>
        <button class="close-button" onclick="togglePanel('logPanel')">Fermer</button>
    </div>

    <div class="countdown" id="countdown">Temps restant : --j --h --m --s</div>

    <script>
        const teams = {
            nico: { points: 10000, frozen: false, freezeTime: 0, freezeTotal: 0, keys: 0 },
            yanis: { points: 10000, frozen: false, freezeTime: 0, freezeTotal: 0, keys: 0 },
            matt: { points: 10000, frozen: false, freezeTime: 0, freezeTotal: 0, keys: 0 }
        };
        const actionsLog = [];
        const endDate = new Date("2024-11-21T18:00:00");
        let autoDecrementActive = false;
        let autoDecrementInterval;

        // Restaurer l'√©tat du jeu depuis localStorage
        function restoreGameState() {
            const savedState = JSON.parse(localStorage.getItem("gameState"));
            if (savedState) {
                Object.assign(teams, savedState.teams);
                actionsLog.push(...savedState.log);
                updateAllDisplay();
                console.log("√âtat du jeu restaur√©.");
            }
        }

        // Sauvegarder l'√©tat du jeu dans localStorage
        function saveGameState() {
            const gameState = {
                teams: JSON.parse(JSON.stringify(teams)),
                log: [...actionsLog]
            };
            localStorage.setItem("gameState", JSON.stringify(gameState));
            console.log("√âtat du jeu sauvegard√©.");
        }

        // D√©tection des jours et heures de d√©compte
        function isCountingTime() {
            const now = new Date();
            const day = now.getDay(); // 0 = Dimanche, 1 = Lundi, ..., 6 = Samedi
            const hour = now.getHours();

            // Du lundi au vendredi, entre 9h et 18h
            if (day >= 1 && day <= 5 && hour >= 9 && hour < 18) return true;
            // Samedi entre 10h et 17h
            if (day === 6 && hour >= 10 && hour < 17) return true;
            // Sinon (dimanche ou jours f√©ri√©s), pas de d√©compte
            return false;
        }

        // Mise √† jour des points si les conditions de temps sont remplies
        function decreasePoints() {
            if (!isCountingTime()) return;

            Object.keys(teams).forEach(teamKey => {
                if (!teams[teamKey].frozen) {
                    teams[teamKey].points = Math.max(0, teams[teamKey].points - 1);
                    document.getElementById(`points-${teamKey}`).textContent = teams[teamKey].points;
                }
            });
            updateRanking();
        }

        // D√©clencher le d√©compte automatique
        function toggleAutoDecrement() {
            autoDecrementActive = !autoDecrementActive;
            document.getElementById("autoDecrementStatus").textContent = autoDecrementActive ? "ON" : "OFF";
            document.getElementById("statusIndicator").style.backgroundColor = autoDecrementActive ? "green" : "red";

            if (autoDecrementActive) {
                autoDecrementInterval = setInterval(decreasePoints, 60000);
            } else {
                clearInterval(autoDecrementInterval);
            }
        }

        // Fonction pour mettre √† jour tous les affichages au chargement
        function updateAllDisplay() {
            Object.keys(teams).forEach(teamKey => {
                document.getElementById(`points-${teamKey}`).textContent = teams[teamKey].points;
                document.getElementById(`freeze-timer-${teamKey}`).textContent = teams[teamKey].frozen ? "Freeze Activ√©" : "";
            });
            updateRanking();
            updateCountdown();
        }

        // Sauvegarde automatique √† la fermeture de la page
        window.addEventListener("beforeunload", saveGameState);

        // Initialisation
        document.addEventListener("DOMContentLoaded", () => {
            restoreGameState(); // Restaure le jeu s'il y a une sauvegarde
            toggleAutoDecrement(); // Active le d√©compte si n√©cessaire
            setInterval(updateCountdown, 1000); // Compte √† rebours mis √† jour chaque seconde
        });

        // Autres fonctions pour la gestion du jeu (ex. updateCountdown, updatePoints, etc.)
    </script>
</body>
</html>
